[一文了解 InnoDB 存储引擎](https://zhuanlan.zhihu.com/p/47581960)

# InnoDB 存储引擎

* InnoDB 是默认的表存储引擎。其特点是行锁设计、支持 MVCC 、支持外键、提供一致性非锁定读、同时被设计用来最有效的利用以及使用内存和 CPU 。
***

## 一、 InnoDB体系架构

* InnoDB 体系结构由后台线程、内存池、文件构成。

### 1.1 后台线程

* InnoDB 后台线程主要有四种不同类型的线程：

>- 1.Master Thread：最核心的一个线程，负责将缓冲池中的数据异步刷新到磁盘，保证数据的一致性。

>- 2.IO Thread： InnoDB 存储引擎使用大量的异步 IO 处理 IO 请求，IO Trhead 负责这些 IO 的请求回调处理。

>- 3.Purge Thread：Purge Thread 用来回收已经使用并分配的 undo 页。InnoDB 支持多个 Purge Thread，可以加快 undo 页的回收。

>- 4.Page Cleaner Thread： 在InnoDB 1.2.x版本新引入，作用是将之前版本中脏页的刷新操作都放入到单独的线程中来完成，减轻了 Master Thread 的工作以及对于用户查询线程的阻塞。
***

### 1.2 内存

* InnoDB 使用缓冲池技术来提高数据库的整体性能。

> 缓冲池简单的说是一块内存区域，数据库中进行的读取页操作，会将从磁盘中读取到的页存放到缓冲池中，下一次读取该页时，会先判断该页是否在内存池中，如果在，就直接在缓冲池中读取。对于数据库中修改页的操作，会先修改缓冲池中的页，然后以一定频率刷新到磁盘，并不是每次页发生变化就刷新到磁盘。

* 在 InnoDB 中，缓冲池中的页大小默认为 16 KB。

> 缓冲池中缓存的数据页类型有：索引页、数据页、undo 页、插入缓冲、自适应哈希索引、InnoDB 的锁信息、数据字典信息等。

* InnoDB 存储引擎通过 Free 链表（空闲链表）管理缓冲池中的缓存页。

> 每次从磁盘中加载一个页到缓冲池中时，就从 Free 链表中取一个空闲的缓存页节点，将加载的页的信息填入对应的空闲缓存页信息中并从链表移除该节点

* 缓冲池最主要的两个功能：

>- 加速读：当需要访问一个页面时，如果这个页面已经在缓冲池中，直接从缓冲池中获取这个页面。

>- 加速写：当需要修改一个页面时，如果这个页面已经在缓冲池中，直接从缓冲池中修改这个页面。



